@Q:
  FOR u IN users
    FILTER u.active == <span class="hljs-literal">true</span>
    LIMIT <span class="hljs-number">0</span>, <span class="hljs-number">4</span>
    FOR f IN relations
      FILTER f.type == @friend &amp;&amp; f.friendOf == u.userId
      RETURN {
        <span class="hljs-string">"user"</span> : u.name,
        <span class="hljs-string">"friendId"</span> : f.thisUser
      }
@B
{
  <span class="hljs-string">"friend"</span>: <span class="hljs-string">"friend"</span>
}
@R
<span style="color:rgb(85,85,255)">Query string:</span>
 <span style="color:rgb(0,187,0)">  FOR u IN users
     FILTER u.active == true
     LIMIT 0, 4
     FOR f IN relations
       FILTER f.type == @friend &amp;&amp; f.friendOf == u.userId
       RETURN {
         "user" : u.name,
         "friendId" : f.thisUser
       }
 </span>

<span style="color:rgb(85,85,255)">Execution plan:</span>
 <span style="color:rgb(187,0,187)">Id</span>   <span style="color:rgb(187,0,187)">NodeType</span>                  <span style="color:rgb(187,0,187)">Est.</span>   <span style="color:rgb(187,0,187)">Comment</span>
  <span style="color:rgb(187,187,0)">1</span>   <span style="color:rgb(0,187,187)">SingletonNode</span>                <span style="color:rgb(0,187,0)">1</span>   * <span style="color:rgb(0,187,187)">ROOT</span>
  <span style="color:rgb(187,187,0)">2</span>   <span style="color:rgb(0,187,187)">EnumerateCollectionNode</span>      <span style="color:rgb(0,187,0)">5</span>     - <span style="color:rgb(0,187,187)">FOR</span> <span style="color:rgb(187,187,0)">u</span> <span style="color:rgb(0,187,187)">IN</span> <span style="color:rgb(187,0,0)">users</span>   <span style="color:rgb(0,0,187)">/* full collection scan */</span>
  <span style="color:rgb(187,187,0)">3</span>   <span style="color:rgb(0,187,187)">CalculationNode</span>              <span style="color:rgb(0,187,0)">5</span>       - <span style="color:rgb(0,187,187)">LET</span> <span style="color:rgb(187,0,187)">#2</span> = (<span style="color:rgb(187,187,0)">u</span>.`<span style="color:rgb(187,187,0)">active</span>` == <span style="color:rgb(0,187,0)">true</span>)   <span style="color:rgb(0,0,187)">/* simple expression */</span>   <span style="color:rgb(0,0,187)">/* collections used:</span> <span style="color:rgb(187,187,0)">u</span> : <span style="color:rgb(187,0,0)">users</span> <span style="color:rgb(0,0,187)">*/</span>
  <span style="color:rgb(187,187,0)">4</span>   <span style="color:rgb(0,187,187)">FilterNode</span>                   <span style="color:rgb(0,187,0)">5</span>       - <span style="color:rgb(0,187,187)">FILTER</span> <span style="color:rgb(187,0,187)">#2</span>
  <span style="color:rgb(187,187,0)">5</span>   <span style="color:rgb(0,187,187)">LimitNode</span>                    <span style="color:rgb(0,187,0)">4</span>       - <span style="color:rgb(0,187,187)">LIMIT</span> <span style="color:rgb(0,187,0)">0</span>, <span style="color:rgb(0,187,0)">4</span>
  <span style="color:rgb(187,187,0)">6</span>   <span style="color:rgb(0,187,187)">EnumerateCollectionNode</span>     <span style="color:rgb(0,187,0)">36</span>       - <span style="color:rgb(0,187,187)">FOR</span> <span style="color:rgb(187,187,0)">f</span> <span style="color:rgb(0,187,187)">IN</span> <span style="color:rgb(187,0,0)">relations</span>   <span style="color:rgb(0,0,187)">/* full collection scan */</span>
  <span style="color:rgb(187,187,0)">7</span>   <span style="color:rgb(0,187,187)">CalculationNode</span>             <span style="color:rgb(0,187,0)">36</span>         - <span style="color:rgb(0,187,187)">LET</span> <span style="color:rgb(187,0,187)">#4</span> = ((<span style="color:rgb(187,187,0)">f</span>.`<span style="color:rgb(187,187,0)">type</span>` == <span style="color:rgb(0,187,0)">"friend"</span>) &amp;&amp; (<span style="color:rgb(187,187,0)">f</span>.`<span style="color:rgb(187,187,0)">friendOf</span>` == <span style="color:rgb(187,187,0)">u</span>.`<span style="color:rgb(187,187,0)">userId</span>`))   <span style="color:rgb(0,0,187)">/* simple expression */</span>   <span style="color:rgb(0,0,187)">/* collections used:</span> <span style="color:rgb(187,187,0)">f</span> : <span style="color:rgb(187,0,0)">relations</span>, <span style="color:rgb(187,187,0)">u</span> : <span style="color:rgb(187,0,0)">users</span> <span style="color:rgb(0,0,187)">*/</span>
  <span style="color:rgb(187,187,0)">8</span>   <span style="color:rgb(0,187,187)">FilterNode</span>                  <span style="color:rgb(0,187,0)">36</span>         - <span style="color:rgb(0,187,187)">FILTER</span> <span style="color:rgb(187,0,187)">#4</span>
  <span style="color:rgb(187,187,0)">9</span>   <span style="color:rgb(0,187,187)">CalculationNode</span>             <span style="color:rgb(0,187,0)">36</span>         - <span style="color:rgb(0,187,187)">LET</span> <span style="color:rgb(187,0,187)">#6</span> = { <span style="color:rgb(0,187,0)">"user"</span> : <span style="color:rgb(187,187,0)">u</span>.`<span style="color:rgb(187,187,0)">name</span>`, <span style="color:rgb(0,187,0)">"friendId"</span> : <span style="color:rgb(187,187,0)">f</span>.`<span style="color:rgb(187,187,0)">thisUser</span>` }   <span style="color:rgb(0,0,187)">/* simple expression */</span>   <span style="color:rgb(0,0,187)">/* collections used:</span> <span style="color:rgb(187,187,0)">u</span> : <span style="color:rgb(187,0,0)">users</span>, <span style="color:rgb(187,187,0)">f</span> : <span style="color:rgb(187,0,0)">relations</span> <span style="color:rgb(0,0,187)">*/</span>
 <span style="color:rgb(187,187,0)">10</span>   <span style="color:rgb(0,187,187)">ReturnNode</span>                  <span style="color:rgb(0,187,0)">36</span>         - <span style="color:rgb(0,187,187)">RETURN</span> <span style="color:rgb(187,0,187)">#6</span>

<span style="color:rgb(85,85,255)">Indexes used:</span>
 <span style="color:rgb(0,187,0)">none</span>

<span style="color:rgb(85,85,255)">Optimization rules applied:</span>
 <span style="color:rgb(187,0,187)">Id</span>   <span style="color:rgb(187,0,187)">RuleName</span>
  <span style="color:rgb(187,187,0)">1</span>   <span style="color:rgb(0,187,187)">move-calculations-up</span>
  <span style="color:rgb(187,187,0)">2</span>   <span style="color:rgb(0,187,187)">move-filters-up</span>
  <span style="color:rgb(187,187,0)">3</span>   <span style="color:rgb(0,187,187)">move-calculations-up-2</span>
  <span style="color:rgb(187,187,0)">4</span>   <span style="color:rgb(0,187,187)">move-filters-up-2</span>

